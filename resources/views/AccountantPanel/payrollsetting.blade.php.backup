<x-Account-sidebar>
    <x-slot name="title">Payroll Settings</x-slot>
    
    <main class="p-6 bg-slate-50">
        <div class="max-w-7xl mx-auto">
        <!-- Page Header -->
        <div class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold text-slate-900">Payroll Management</h2>
                <p class="text-sm text-slate-600 mt-1">Manage staff and teacher payroll settings</p>
            </div>
            <button type="button" onclick="openAddModal()" class="inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm transition-colors duration-150">
                <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                Add New Employee
            </button>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="users" class="w-6 h-6 text-indigo-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-600">Total Employees</p>
                        <p class="text-2xl font-bold text-slate-900">{{ $totalEmployees ?? 0 }}</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="graduation-cap" class="w-6 h-6 text-green-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-600">Teachers</p>
                        <p class="text-2xl font-bold text-slate-900">{{ $totalTeachers ?? 0 }}</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="user-check" class="w-6 h-6 text-blue-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-600">Staff</p>
                        <p class="text-2xl font-bold text-slate-900">{{ $totalStaff ?? 0 }}</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="dollar-sign" class="w-6 h-6 text-amber-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-slate-600">Monthly Payroll</p>
                        <p class="text-2xl font-bold text-slate-900">${{ number_format($totalPayroll ?? 0, 2) }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter and Search Section -->
        <div class="bg-white rounded-xl p-6 border border-slate-200 shadow-sm mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2">
                    <input type="text" id="searchEmployee" placeholder="Search by name or ID..." class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-colors">
                </div>
                <div>
                    <select id="filterType" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-colors">
                        <option value="">All Types</option>
                        <option value="teacher">Teachers</option>
                        <option value="staff">Staff</option>
                        <option value="admin">Administrative</option>
                    </select>
                </div>
                <div>
                    <select id="filterStatus" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-colors">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
            <button onclick="resetFilters()" class="mt-4 inline-flex items-center px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-lg transition-colors duration-150">
                <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                Reset
            </button>
        </div>

        <!-- Payroll Table -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0">Employee Payroll Records</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0" id="payrollTable">
                        <thead class="table-light">
                            <tr>
                                <th class="px-4">Employee ID</th>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Position</th>
                                <th>Base Salary</th>
                                <th>Allowances</th>
                                <th>Deductions</th>
                                <th>Net Salary</th>
                                <th>Payment Method</th>
                                <th>Status</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @forelse($employees ?? [] as $employee)
                            <tr>
                                <td class="px-4">{{ $employee->employee_id }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-sm me-2">
                                            <span class="avatar-title rounded-circle bg-primary">
                                                {{ strtoupper(substr($employee->name, 0, 1)) }}
                                            </span>
                                        </div>
                                        <div>
                                            <div class="fw-medium">{{ $employee->name }}</div>
                                            <small class="text-muted">{{ $employee->email }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-{{ $employee->type === 'teacher' ? 'success' : 'info' }}-subtle text-{{ $employee->type === 'teacher' ? 'success' : 'info' }}">
                                        {{ ucfirst($employee->type) }}
                                    </span>
                                </td>
                                <td>{{ $employee->position }}</td>
                                <td>${{ number_format($employee->base_salary, 2) }}</td>
                                <td>${{ number_format($employee->allowances ?? 0, 2) }}</td>
                                <td>${{ number_format($employee->deductions ?? 0, 2) }}</td>
                                <td class="fw-bold">${{ number_format($employee->net_salary, 2) }}</td>
                                <td>
                                    @if($employee->payment_method === 'bank')
                                    <span class="text-primary"><i class="fas fa-university me-1"></i>Bank Transfer</span>
                                    @else
                                    <span class="text-success"><i class="fas fa-money-bill me-1"></i>Cash</span>
                                    @endif
                                </td>
                                <td>
                                    @if($employee->status === 'active')
                                    <span class="badge bg-success-subtle text-success">Active</span>
                                    @else
                                    <span class="badge bg-secondary-subtle text-secondary">Inactive</span>
                                    @endif
                                </td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="viewEmployee({{ $employee->id }})" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning me-1" onclick="editEmployee({{ $employee->id }})" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteEmployee({{ $employee->id }})" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            @empty
                            <tr>
                                <td colspan="11" class="text-center py-5">
                                    <i class="fas fa-users fs-1 text-muted mb-3 d-block"></i>
                                    <p class="text-muted">No payroll records found. Click "Add New Employee" to get started.</p>
                                </td>
                            </tr>
                            @endforelse
                        </tbody>
                    </table>
                </div>
            </div>
            @if(isset($employees) && $employees->hasPages())
            <div class="card-footer bg-white">
                {{ $employees->links() }}
            </div>
            @endif
        </div>
    </div>

    <!-- Add/Edit Payroll Modal -->
    <div class="modal fade" id="addPayrollModal" tabindex="-1" aria-labelledby="addPayrollModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addPayrollModalLabel">
                        <i class="fas fa-user-plus me-2"></i>Add New Employee to Payroll
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="payrollForm" method="POST" action="">
                    @csrf
                    <div class="modal-body">
                        <!-- Personal Information -->
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-user me-2"></i>Personal Information
                        </h6>
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="employee_id" class="form-label">Employee ID <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="employee_id" name="employee_id" required>
                                <div class="form-text">Unique identifier for the employee</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email Address <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="phone" name="phone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="type" class="form-label">Employee Type <span class="text-danger">*</span></label>
                                <select class="form-select" id="type" name="type" required>
                                    <option value="">Select Type</option>
                                    <option value="teacher">Teacher</option>
                                    <option value="staff">Staff</option>
                                    <option value="admin">Administrative</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="position" class="form-label">Position/Designation <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="position" name="position" placeholder="e.g., Mathematics Teacher" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="department" class="form-label">Department</label>
                                <input type="text" class="form-control" id="department" name="department" placeholder="e.g., Science Department">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="join_date" class="form-label">Joining Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="join_date" name="join_date" required>
                            </div>
                        </div>

                        <!-- Salary Information -->
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-dollar-sign me-2"></i>Salary Information
                        </h6>
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="base_salary" class="form-label">Base Salary <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="base_salary" name="base_salary" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="payment_frequency" class="form-label">Payment Frequency <span class="text-danger">*</span></label>
                                <select class="form-select" id="payment_frequency" name="payment_frequency" required>
                                    <option value="">Select Frequency</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="bi-weekly">Bi-Weekly</option>
                                    <option value="weekly">Weekly</option>
                                </select>
                            </div>
                        </div>

                        <!-- Allowances -->
                        <h6 class="text-success mb-3">
                            <i class="fas fa-plus-circle me-2"></i>Allowances
                        </h6>
                        <div class="row mb-4">
                            <div class="col-md-4 mb-3">
                                <label for="housing_allowance" class="form-label">Housing Allowance</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="housing_allowance" name="housing_allowance" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="transport_allowance" class="form-label">Transport Allowance</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="transport_allowance" name="transport_allowance" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="meal_allowance" class="form-label">Meal Allowance</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="meal_allowance" name="meal_allowance" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="medical_allowance" class="form-label">Medical Allowance</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="medical_allowance" name="medical_allowance" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="other_allowance" class="form-label">Other Allowances</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="other_allowance" name="other_allowance" step="0.01" min="0" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Deductions -->
                        <h6 class="text-danger mb-3">
                            <i class="fas fa-minus-circle me-2"></i>Deductions
                        </h6>
                        <div class="row mb-4">
                            <div class="col-md-4 mb-3">
                                <label for="tax_deduction" class="form-label">Tax Deduction</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="tax_deduction" name="tax_deduction" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="insurance_deduction" class="form-label">Insurance</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="insurance_deduction" name="insurance_deduction" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="provident_fund" class="form-label">Provident Fund</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="provident_fund" name="provident_fund" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="loan_deduction" class="form-label">Loan Deduction</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="loan_deduction" name="loan_deduction" step="0.01" min="0" value="0">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="other_deduction" class="form-label">Other Deductions</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="other_deduction" name="other_deduction" step="0.01" min="0" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Net Salary Display -->
                        <div class="alert alert-info mb-4">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="mb-1">Net Salary (Calculated)</h6>
                                    <small class="text-muted">Base Salary + Total Allowances - Total Deductions</small>
                                </div>
                                <div class="col-md-4 text-end">
                                    <h4 class="mb-0" id="netSalaryDisplay">$0.00</h4>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Details -->
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-university me-2"></i>Payment Information
                        </h6>
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="payment_method" class="form-label">Payment Method <span class="text-danger">*</span></label>
                                <select class="form-select" id="payment_method" name="payment_method" required>
                                    <option value="">Select Method</option>
                                    <option value="bank">Bank Transfer</option>
                                    <option value="cash">Cash</option>
                                    <option value="check">Check</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3" id="bankDetailsSection" style="display: none;">
                                <label for="bank_name" class="form-label">Bank Name</label>
                                <input type="text" class="form-control" id="bank_name" name="bank_name">
                            </div>
                            <div class="col-md-6 mb-3" id="accountNumberSection" style="display: none;">
                                <label for="account_number" class="form-label">Account Number</label>
                                <input type="text" class="form-control" id="account_number" name="account_number">
                            </div>
                            <div class="col-md-6 mb-3" id="accountNameSection" style="display: none;">
                                <label for="account_name" class="form-label">Account Holder Name</label>
                                <input type="text" class="form-control" id="account_name" name="account_name">
                            </div>
                            <div class="col-md-6 mb-3" id="ifscSection" style="display: none;">
                                <label for="ifsc_code" class="form-label">IFSC/Routing Code</label>
                                <input type="text" class="form-control" id="ifsc_code" name="ifsc_code">
                            </div>
                            <div class="col-md-6 mb-3" id="branchSection" style="display: none;">
                                <label for="branch_name" class="form-label">Branch Name</label>
                                <input type="text" class="form-control" id="branch_name" name="branch_name">
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-info-circle me-2"></i>Additional Information
                        </h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="status" class="form-label">Employment Status <span class="text-danger">*</span></label>
                                <select class="form-select" id="status" name="status" required>
                                    <option value="active" selected>Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="on_leave">On Leave</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="contract_type" class="form-label">Contract Type</label>
                                <select class="form-select" id="contract_type" name="contract_type">
                                    <option value="permanent">Permanent</option>
                                    <option value="temporary">Temporary</option>
                                    <option value="contract">Contract</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label for="notes" class="form-label">Notes/Remarks</label>
                                <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Any additional information..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Save Employee
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Employee Details Modal -->
    <div class="modal fade" id="viewEmployeeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user me-2"></i>Employee Payroll Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="employeeDetailsContent">
                    <!-- Content will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Calculate Net Salary in real-time
        function calculateNetSalary() {
            const baseSalary = parseFloat(document.getElementById('base_salary').value) || 0;
            
            // Allowances
            const housingAllowance = parseFloat(document.getElementById('housing_allowance').value) || 0;
            const transportAllowance = parseFloat(document.getElementById('transport_allowance').value) || 0;
            const mealAllowance = parseFloat(document.getElementById('meal_allowance').value) || 0;
            const medicalAllowance = parseFloat(document.getElementById('medical_allowance').value) || 0;
            const otherAllowance = parseFloat(document.getElementById('other_allowance').value) || 0;
            
            // Deductions
            const taxDeduction = parseFloat(document.getElementById('tax_deduction').value) || 0;
            const insuranceDeduction = parseFloat(document.getElementById('insurance_deduction').value) || 0;
            const providentFund = parseFloat(document.getElementById('provident_fund').value) || 0;
            const loanDeduction = parseFloat(document.getElementById('loan_deduction').value) || 0;
            const otherDeduction = parseFloat(document.getElementById('other_deduction').value) || 0;
            
            const totalAllowances = housingAllowance + transportAllowance + mealAllowance + medicalAllowance + otherAllowance;
            const totalDeductions = taxDeduction + insuranceDeduction + providentFund + loanDeduction + otherDeduction;
            const netSalary = baseSalary + totalAllowances - totalDeductions;
            
            document.getElementById('netSalaryDisplay').textContent = '$' + netSalary.toFixed(2);
        }

        // Show/Hide Bank Details based on Payment Method
        document.getElementById('payment_method')?.addEventListener('change', function() {
            const bankSections = ['bankDetailsSection', 'accountNumberSection', 'accountNameSection', 'ifscSection', 'branchSection'];
            
            if (this.value === 'bank') {
                bankSections.forEach(section => {
                    document.getElementById(section).style.display = 'block';
                });
            } else {
                bankSections.forEach(section => {
                    document.getElementById(section).style.display = 'none';
                });
            }
        });

        // Add event listeners for real-time calculation
        document.addEventListener('DOMContentLoaded', function() {
            const salaryInputs = [
                'base_salary', 'housing_allowance', 'transport_allowance', 'meal_allowance',
                'medical_allowance', 'other_allowance', 'tax_deduction', 'insurance_deduction',
                'provident_fund', 'loan_deduction', 'other_deduction'
            ];
            
            salaryInputs.forEach(inputId => {
                const element = document.getElementById(inputId);
                if (element) {
                    element.addEventListener('input', calculateNetSalary);
                }
            });
        });

        // View Employee Details
        function viewEmployee(id) {
            fetch(`/payroll/${id}`)
                .then(response => response.json())
                .then(data => {
                    const content = `
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Employee ID:</strong> ${data.employee_id}</p>
                                <p><strong>Name:</strong> ${data.name}</p>
                                <p><strong>Email:</strong> ${data.email}</p>
                                <p><strong>Position:</strong> ${data.position}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Base Salary:</strong> $${parseFloat(data.base_salary).toFixed(2)}</p>
                                <p><strong>Net Salary:</strong> $${parseFloat(data.net_salary).toFixed(2)}</p>
                                <p><strong>Payment Method:</strong> ${data.payment_method}</p>
                                <p><strong>Status:</strong> ${data.status}</p>
                            </div>
                        </div>
                    `;
                    document.getElementById('employeeDetailsContent').innerHTML = content;
                    new bootstrap.Modal(document.getElementById('viewEmployeeModal')).show();
                })
                .catch(error => console.error('Error:', error));
        }

        // Edit Employee
        function editEmployee(id) {
            fetch(`/payroll/${id}/edit`)
                .then(response => response.json())
                .then(data => {
                    Object.keys(data).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = data[key];
                        }
                    });
                    
                    document.getElementById('payrollForm').action = `/payroll/${id}`;
                    document.getElementById('addPayrollModalLabel').textContent = 'Edit Employee Payroll';
                    
                    if (!document.querySelector('input[name="_method"]')) {
                        const methodInput = document.createElement('input');
                        methodInput.type = 'hidden';
                        methodInput.name = '_method';
                        methodInput.value = 'PUT';
                        document.getElementById('payrollForm').appendChild(methodInput);
                    }
                    
                    new bootstrap.Modal(document.getElementById('addPayrollModal')).show();
                    calculateNetSalary();
                })
                .catch(error => console.error('Error:', error));
        }

        // Delete Employee
        function deleteEmployee(id) {
            if (confirm('Are you sure you want to delete this employee from payroll?')) {
                fetch(`/payroll/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content,
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        }

        // Reset Filters
        function resetFilters() {
            document.getElementById('searchEmployee').value = '';
            document.getElementById('filterType').value = '';
            document.getElementById('filterStatus').value = '';
            filterTable();
        }

        // Search functionality
        document.getElementById('searchEmployee')?.addEventListener('input', function() {
            const searchValue = this.value.toLowerCase();
            const tableRows = document.querySelectorAll('#payrollTable tbody tr');
            
            tableRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchValue) ? '' : 'none';
            });
        });

        // Filter functionality
        document.getElementById('filterType')?.addEventListener('change', function() {
            filterTable();
        });

        document.getElementById('filterStatus')?.addEventListener('change', function() {
            filterTable();
        });

        function filterTable() {
            const typeFilter = document.getElementById('filterType').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value.toLowerCase();
            const tableRows = document.querySelectorAll('#payrollTable tbody tr');
            
            tableRows.forEach(row => {
                const typeCell = row.cells[2]?.textContent.toLowerCase();
                const statusCell = row.cells[9]?.textContent.toLowerCase();
                
                const typeMatch = !typeFilter || typeCell.includes(typeFilter);
                const statusMatch = !statusFilter || statusCell.includes(statusFilter);
                
                row.style.display = (typeMatch && statusMatch) ? '' : 'none';
            });
        }
    </script>

</x-Account-sidebar>